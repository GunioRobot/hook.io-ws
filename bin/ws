#!/usr/bin/env node

var WebSocketHook = require('../lib/ws').HookSocket;

var mtgoxTest = new WebSocketHook({
  name: 'mtgox',
  url:'ws://websocket.mtgox.com/mtgox',
  debug:true
});

var mtgoxChannels = {
  channels:[
    {key:'dbf1dee9-4f2e-4a08-8cb7-748919a71b21', name:'Trades', private:'trade'},
    {key:'d5f06780-30a8-4a48-a2f8-7ed181b4a13f', name:'MtGox Tick', private: 'ticker'},
    {key:'24e67e0d-1cad-4cc0-9e7a-f8523ef460fe', name:'All Market', private:'depth'}
  ],
  getChannel: function(key){
    var selected = this.channels.filter(function(c){
      if (c.key == key)
        return true;
      return false;
    });
    return selected[0];
  },
  showMsg: function(data){
    var ch = this.getChannel(data.channel);
    this['_'+ch.private](data);
  },
  _depth: function(data){
    console.log('Cambio en el OrderBook', data.depth);
  },
  _trade: function(data){
    console.log('Negocio!', data.trade);
  },
  _ticker: function(data){
    console.log('Cambio del Tick', data.ticker);
  }
};


mtgoxTest.on('websocket::message',function(data){
  if (data.op == 'subscribe'){
    console.log('Now suscribe to: %s',mtgoxChannels.getChannel(data.channel).name);
  }
  mtgoxChannels.showMsg(data);
});

mtgoxTest.start();
